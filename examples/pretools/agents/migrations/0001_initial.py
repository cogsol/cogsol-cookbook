# Generated by CogSol 0.2.0 on 2026-02-24 10:51
from cogsol.db import migrations


class Migration(migrations.Migration):
    initial = True
    dependencies = []
    operations = [
        migrations.CreateTool(name='CurrentDateTime', fields={'name': 'current_datetime', 'description': 'Returns the current date, time, day of the week, and period of the day for Montevideo (UTC-3).', 'show_tool_message': False, 'parameters': {}, '__code__': 'def run(self, chat=None, data=None, secrets=None, log=None):\n    try:\n        from datetime import datetime, timezone, timedelta\n\n        log.append("Fetching current date and time for Montevideo (UTC-3)")\n\n        tz = timezone(timedelta(hours=-3))\n        now = datetime.now(tz)\n        hour = now.hour\n\n        if hour < 12:\n            period = "morning"\n        elif hour < 18:\n            period = "afternoon"\n        else:\n            period = "evening"\n\n        date_str = now.strftime("%Y-%m-%d")\n        time_str = now.strftime("%H:%M")\n        day_of_week = now.strftime("%A")\n\n        data[\'prompt_params\'][\'context\'][\'Current date and time in Montevideo (UTC-3)\'] = (\n            f"{date_str} {time_str}, {day_of_week}, {period}"\n        )\n\n        log.append(f"Result: {date_str} {time_str} ({period})")\n\n    except Exception as exc:\n        log.append(f"Error: {exc}")'}),
        migrations.CreateTool(name='DailyTip', fields={'name': 'daily_tip', 'description': 'Returns a CogSol Framework tip of the day. The tip rotates automatically based on the current date.', 'show_tool_message': False, 'parameters': {}, '__code__': 'def run(self, chat=None, data=None, secrets=None, log=None):\n    try:\n        from datetime import datetime, timezone, timedelta\n\n        log.append("Selecting CogSol tip of the day")\n\n        tips = [\n            "Run `makemigrations` before `migrate` to review changes before deploying them.",\n            "Use `genconfigs.QA()` for conversational agents and `genconfigs.FastRetrieval()` for search-focused pretools.",\n            "Keep system prompts in separate Markdown files under prompts/ for easy editing.",\n            "Each tool should do one thing well: split complex logic into multiple tools.",\n            "Use `max_consecutive_tool_calls` to prevent infinite tool-call loops.",\n            "FAQs are matched by semantic similarity, while fixed responses use exact key matching.",\n            "Lessons shape the agent\'s behavior across all responses: use them for guidelines and best practices.",\n            "Store environment variables in `.env` and never commit credentials to version control.",\n            "Use `python manage.py chat --agent AgentName` to test your agent interactively after deploying.",\n            "Pretools run before the main generation phase: use them to gather context that enriches the agent\'s response.",\n        ]\n\n        tz = timezone(timedelta(hours=-3))\n        day_of_year = datetime.now(tz).timetuple().tm_yday\n        index = day_of_year % len(tips)\n        tip = tips[index]\n\n        data[\'prompt_params\'][\'context\'][\'CogSol tip of the day\'] = tip\n\n        log.append(f"Selected tip #{index + 1}: {tip[:50]}...")\n\n    except Exception as exc:\n        log.append(f"Error: {exc}")'}),
        migrations.CreateTool(name='WeatherInfo', fields={'name': 'weather_info', 'description': 'Returns the current weather conditions for Montevideo including temperature, sky condition, and wind speed. Uses the free Open-Meteo API (no API key required).', 'show_tool_message': False, 'parameters': {}, '__code__': 'def run(self, chat=None, data=None, secrets=None, log=None):\n    try:\n        import json\n        import urllib.request\n\n        log.append("Fetching weather from Open-Meteo API")\n\n        weather_codes = {\n            0: "Clear sky",\n            1: "Mainly clear",\n            2: "Partly cloudy",\n            3: "Overcast",\n            45: "Fog",\n            48: "Depositing rime fog",\n            51: "Light drizzle",\n            53: "Moderate drizzle",\n            55: "Dense drizzle",\n            61: "Slight rain",\n            63: "Moderate rain",\n            65: "Heavy rain",\n            71: "Slight snow fall",\n            73: "Moderate snow fall",\n            75: "Heavy snow fall",\n            77: "Snow grains",\n            80: "Slight rain showers",\n            81: "Moderate rain showers",\n            82: "Violent rain showers",\n            85: "Slight snow showers",\n            86: "Heavy snow showers",\n            95: "Thunderstorm",\n            96: "Thunderstorm with slight hail",\n            99: "Thunderstorm with heavy hail",\n        }\n\n        latitude = -34.9011\n        longitude = -56.1645\n\n        url = (\n            f"https://api.open-meteo.com/v1/forecast"\n            f"?latitude={latitude}&longitude={longitude}"\n            f"&current_weather=true"\n        )\n\n        with urllib.request.urlopen(url, timeout=5) as response:\n            weather_data = json.loads(response.read().decode())\n\n        weather = weather_data["current_weather"]\n        code = weather.get("weathercode", -1)\n        condition = weather_codes.get(code, "Unknown")\n        temp = weather["temperature"]\n        wind = weather["windspeed"]\n\n        data[\'prompt_params\'][\'context\'][\'Current weather in Montevideo\'] = (\n            f"{temp}°C, {condition}, wind {wind} km/h"\n        )\n\n        log.append(f"Result: {temp}°C, {condition}, wind {wind} km/h")\n\n    except Exception as exc:\n        log.append(f"Error fetching weather: {exc}")'}),
        migrations.CreateAgent(name='PretoolsAgent', fields={'system_prompt': '# Pretools Assistant\n\nYou are a helpful assistant powered by the CogSol Framework.\n\nAlways include any available date, weather, and tip information in your responses. Label each piece with its source in bold brackets, for example:\n\n**[Current Date]** Friday afternoon, February 13\n**[Weather]** 23.9°C, Mainly clear\n**[Tip of the Day]** Use max_consecutive_tool_calls...\n\nDo not invent or guess any of these values. If a piece of information is not available, skip it.', 'generation_config': 'QA', 'pregeneration_config': 'QA', 'temperature': 0.3, 'max_responses': 10, 'max_msg_length': 2048, 'max_consecutive_tool_calls': 3, 'pretools': ['current_datetime', 'weather_info', 'daily_tip'], 'initial_message': 'Hello! I am the Pretools Assistant. Before each response, three pretools run automatically: one fetches the current date and time, another checks the weather in Montevideo, and a third picks a daily CogSol tip. Ask me anything and you will see them in action!', 'forced_termination_message': 'We are ending this conversation to preserve security and integrity.', 'no_information_message': "I don't have specific information about that topic. Please check the official documentation at https://docs.cogsol.ai.", 'name': 'Pretools'}, meta={'name': 'PretoolsAgent', 'chat_name': 'Pretools Assistant'}),
    ]
