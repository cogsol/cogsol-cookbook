# Generated by CogSol 0.2.0 on 2026-02-24 10:25
from cogsol.db import migrations


class Migration(migrations.Migration):
    initial = True
    dependencies = []
    operations = [
        migrations.CreateRetrievalTool(name='FlightSearch', fields={'description': 'Search available flight routes, schedules, and pricing.', 'parameters': [], 'name': 'FlightSearch'}),
        migrations.CreateRetrievalTool(name='HotelSearch', fields={'description': 'Search hotel accommodations, locations, and rates.', 'parameters': [], 'name': 'HotelSearch'}),
        migrations.CreateRetrievalTool(name='PolicySearch', fields={'description': 'Search corporate travel expense policies and approval rules.', 'parameters': [], 'name': 'PolicySearch'}),
        migrations.CreateTool(name='PlanTravel', fields={'name': 'plan_travel', 'description': 'Plan a business trip by consulting flight, hotel, and expense policy specialists. Returns a consolidated travel plan with all relevant information.', 'show_tool_message': False, 'parameters': {'query': {'description': 'The full travel request with destination, dates, origin, and preferences', 'type': 'string', 'required': True}}, '__code__': '@tool_params(\n    query={\n        "description": "The full travel request with destination, dates, origin, and preferences",\n        "type": "string",\n        "required": True,\n    },\n)\ndef run(self, query="", chat=None, data=None, secrets=None, log=None):\n    from assistant.services.chat import create_chat_parallel\n\n    # Update these IDs after deploying sub-agents (see README)\n    agent_ids = {\n        "flights": 0,\n        "hotels": 0,\n        "policies": 0,\n    }\n\n    # Separate configured from unconfigured agents\n    chat_data_list = []\n    configured_names = []\n    unconfigured = []\n\n    for name, agent_id in agent_ids.items():\n        if not agent_id:\n            unconfigured.append(f"## {name.title()}\\nNot configured (agent ID is 0).\\n")\n            continue\n        configured_names.append(name)\n        chat_data_list.append({\n            "assistant": agent_id,\n            "message": query,\n            "chat_metadata": {"delegated_from": chat.id},\n        })\n\n    if not chat_data_list:\n        return "No specialists configured (all agent IDs are 0)."\n\n    log.append(f"Consulting {len(chat_data_list)} specialists in parallel...")\n    responses = create_chat_parallel(\n        chat_data_list=chat_data_list,\n        max_threads=len(chat_data_list),\n        timeout=60,\n    )\n\n    results = []\n    for name, result in zip(configured_names, responses):\n        label = name.title()\n        if isinstance(result, dict) and "error" in result:\n            log.append(f"{label} failed: {result[\'error\']}")\n            results.append(f"## {label}\\nCould not retrieve information.\\n")\n            continue\n        try:\n            messages = result.data.get("messages", [])\n            content = (\n                messages[2].get("content")\n                if len(messages) > 2\n                else None\n            )\n            if content:\n                log.append(f"{label} responded successfully")\n                results.append(f"## {label}\\n{content}\\n")\n            else:\n                log.append(f"{label} returned no content")\n                results.append(f"## {label}\\nNo response received.\\n")\n        except Exception as e:\n            log.append(f"{label} error: {str(e)}")\n            results.append(f"## {label}\\nCould not retrieve information.\\n")\n\n    results.extend(unconfigured)\n    return "\\n".join(results)'}),
        migrations.CreateAgent(name='ExpensePolicyAgent', fields={'system_prompt': '# Expense Policy Advisor\n\nYou provide guidance on corporate travel expense policies, spending limits, and approval requirements.', 'generation_config': 'QA', 'temperature': 0.3, 'max_responses': 10, 'max_msg_length': 2048, 'max_consecutive_tool_calls': 3, 'tools': ['PolicySearch'], 'initial_message': 'Hello! I can help with corporate travel expense policies. Ask me about spending limits, approval workflows, or reporting requirements.', 'forced_termination_message': 'We are ending this conversation to preserve security and integrity.', 'no_information_message': 'I could not find a policy matching your question. Please visit https://docs.cogsol.ai for additional resources.', 'name': 'ExpensePolicy'}, meta={'name': 'ExpensePolicyAgent', 'chat_name': 'Expense Policy Assistant'}),
        migrations.CreateAgent(name='FlightSearchAgent', fields={'system_prompt': '# Flight Search Specialist\n\nYou help find the best flight options based on routes, dates, and traveler preferences.', 'generation_config': 'QA', 'temperature': 0.3, 'max_responses': 10, 'max_msg_length': 2048, 'max_consecutive_tool_calls': 3, 'tools': ['FlightSearch'], 'initial_message': 'Hello! I can help you find flights. Tell me your origin, destination, and travel dates.', 'forced_termination_message': 'We are ending this conversation to preserve security and integrity.', 'no_information_message': 'I could not find flights matching your criteria. Please visit https://docs.cogsol.ai for additional resources.', 'name': 'FlightSearch'}, meta={'name': 'FlightSearchAgent', 'chat_name': 'Flight Search Assistant'}),
        migrations.CreateAgent(name='HotelSearchAgent', fields={'system_prompt': '# Hotel Search Specialist\n\nYou help find suitable hotel accommodations based on location, dates, and corporate rate availability.', 'generation_config': 'QA', 'temperature': 0.3, 'max_responses': 10, 'max_msg_length': 2048, 'max_consecutive_tool_calls': 3, 'tools': ['HotelSearch'], 'initial_message': 'Hello! I can help you find hotels. Tell me the city, area, and your travel dates.', 'forced_termination_message': 'We are ending this conversation to preserve security and integrity.', 'no_information_message': 'I could not find hotels matching your criteria. Please visit https://docs.cogsol.ai for additional resources.', 'name': 'HotelSearch'}, meta={'name': 'HotelSearchAgent', 'chat_name': 'Hotel Search Assistant'}),
        migrations.CreateAgent(name='TravelOrchestratorAgent', fields={'system_prompt': '# Corporate Travel Assistant\n\nYou coordinate business travel planning by consulting specialized agents for flights, hotels, and company expense policies, then consolidating their responses into actionable summaries.', 'generation_config': 'QA', 'temperature': 0.3, 'max_responses': 10, 'max_msg_length': 2048, 'max_consecutive_tool_calls': 1, 'tools': ['plan_travel'], 'initial_message': 'Welcome! I can help you plan business trips. For example: "I need to fly from Buenos Aires to Madrid next Monday, returning March 7. I\'d like a hotel near Castellana."', 'forced_termination_message': 'We are ending this conversation to preserve security and integrity.', 'no_information_message': 'I could not find the information you need right now. Please visit https://docs.cogsol.ai for additional resources.', 'name': 'TravelOrchestrator'}, meta={'name': 'TravelOrchestratorAgent', 'chat_name': 'Corporate Travel Assistant'}),
    ]
