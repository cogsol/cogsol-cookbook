# Generated by CogSol 0.2.0 on 2026-02-12 14:22
from cogsol.db import migrations


class Migration(migrations.Migration):
    initial = False
    dependencies = [('agents', '0002_auto_20260212_1400')]
    operations = [
        migrations.AlterField(model_name='CurrentDateTime', name='__code__', value='def run(self, chat=None, data=None, secrets=None, log=None):\n    try:\n        from datetime import datetime, timezone, timedelta\n\n        log.append("Fetching current date and time for Montevideo (UTC-3)")\n\n        tz = timezone(timedelta(hours=-3))\n        now = datetime.now(tz)\n        hour = now.hour\n\n        if hour < 12:\n            period = "morning"\n        elif hour < 18:\n            period = "afternoon"\n        else:\n            period = "evening"\n\n        result = {\n            "date": now.strftime("%Y-%m-%d"),\n            "time": now.strftime("%H:%M"),\n            "day_of_week": now.strftime("%A"),\n            "period": period,\n            "timezone": "UTC-3 (Montevideo)",\n        }\n\n        log.append(f"Result: {result[\'date\']} {result[\'time\']} ({period})")\n\n        return result\n\n    except Exception as exc:\n        log.append(f"Error: {exc}")\n        return {"error": str(exc)}', entity='tools', scope='fields'),
        migrations.AlterField(model_name='DailyTip', name='__code__', value='def run(self, chat=None, data=None, secrets=None, log=None):\n    try:\n        from datetime import datetime, timezone, timedelta\n\n        log.append("Selecting tip of the day")\n\n        tips = [\n            "Run `makemigrations` before `migrate` to review changes before deploying them.",\n            "Use `genconfigs.QA()` for conversational agents and `genconfigs.FastRetrieval()` for search-focused pretools.",\n            "Keep system prompts in separate Markdown files under prompts/ for easy editing.",\n            "Each tool should do one thing well — split complex logic into multiple tools.",\n            "Use `max_consecutive_tool_calls` to prevent infinite tool-call loops.",\n            "FAQs are matched by semantic similarity, while fixed responses use exact key matching.",\n            "Lessons shape the agent\'s behavior across all responses — use them for guidelines and best practices.",\n            "Store environment variables in `.env` and never commit credentials to version control.",\n            "Use `python manage.py chat --agent AgentName` to test your agent interactively after deploying.",\n            "Pretools run before the main generation phase — use them to gather context that enriches the agent\'s response.",\n        ]\n\n        tz = timezone(timedelta(hours=-3))\n        day_of_year = datetime.now(tz).timetuple().tm_yday\n        index = day_of_year % len(tips)\n        tip = tips[index]\n\n        log.append(f"Selected tip #{index + 1}: {tip[:50]}...")\n\n        return {"tip": tip}\n\n    except Exception as exc:\n        log.append(f"Error: {exc}")\n        return {"error": str(exc)}', entity='tools', scope='fields'),
        migrations.AlterField(model_name='WeatherInfo', name='__code__', value='def run(self, chat=None, data=None, secrets=None, log=None):\n    try:\n        import json\n        import urllib.request\n\n        log.append("Fetching weather from Open-Meteo API")\n\n        weather_codes = {\n            0: "Clear sky",\n            1: "Mainly clear",\n            2: "Partly cloudy",\n            3: "Overcast",\n            45: "Fog",\n            48: "Depositing rime fog",\n            51: "Light drizzle",\n            53: "Moderate drizzle",\n            55: "Dense drizzle",\n            61: "Slight rain",\n            63: "Moderate rain",\n            65: "Heavy rain",\n            71: "Slight snow fall",\n            73: "Moderate snow fall",\n            75: "Heavy snow fall",\n            77: "Snow grains",\n            80: "Slight rain showers",\n            81: "Moderate rain showers",\n            82: "Violent rain showers",\n            85: "Slight snow showers",\n            86: "Heavy snow showers",\n            95: "Thunderstorm",\n            96: "Thunderstorm with slight hail",\n            99: "Thunderstorm with heavy hail",\n        }\n\n        latitude = -34.9011\n        longitude = -56.1645\n\n        url = (\n            f"https://api.open-meteo.com/v1/forecast"\n            f"?latitude={latitude}&longitude={longitude}"\n            f"&current_weather=true"\n        )\n\n        with urllib.request.urlopen(url, timeout=5) as response:\n            weather_data = json.loads(response.read().decode())\n\n        weather = weather_data["current_weather"]\n        code = weather.get("weathercode", -1)\n        condition = weather_codes.get(code, "Unknown")\n\n        result = {\n            "temperature_celsius": weather["temperature"],\n            "condition": condition,\n            "wind_speed_kmh": weather["windspeed"],\n            "location": "Montevideo, Uruguay",\n        }\n\n        log.append(\n            f"Result: {result[\'temperature_celsius\']}°C, "\n            f"{result[\'condition\']}, wind {result[\'wind_speed_kmh\']} km/h"\n        )\n\n        return result\n\n    except Exception as exc:\n        log.append(f"Error fetching weather: {exc}")\n        return {"error": "Could not fetch weather data."}', entity='tools', scope='fields'),
    ]
